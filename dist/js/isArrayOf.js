/// <reference path="../typings/underscore/underscore.d.ts" />
"use strict";
const _ = require("underscore");
const base_1 = require("./base");
class IsArrayOf extends base_1.Base {
    constructor(path, itemValidatorFactory, itemValidatorName) {
        super(path);
        this.itemValidatorFactory = itemValidatorFactory;
        this.itemValidatorName = itemValidatorName;
        this.validateArray();
    }
    validateArray() {
        this.satisfies('isArray', (value) => {
            if (!_.isArray(value))
                return false;
            let passed = true;
            for (let i = 0; i < value.length; i++) {
                const item = value[i];
                const path = this.path.slice();
                path.push(i);
                const child = this.itemValidatorFactory(path);
                passed = passed && (!base_1.Base.hasValue(item) || child.test(item));
            }
            return passed;
        });
    }
    length(expected) {
        this.satisfies('length', (value) => !base_1.Base.hasValue(value) || value.length === expected);
        return this;
    }
    lengthInRange(lower, upper) {
        this.satisfies('lengthInRange', (value) => !base_1.Base.hasValue(value) || (lower === undefined || value.length >= lower) && (upper === undefined || value.length <= upper));
        return this;
    }
}
exports.IsArrayOf = IsArrayOf;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImlzQXJyYXlPZi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSw4REFBOEQ7O0FBRTlELE1BQVksQ0FBQyxXQUFNLFlBQVksQ0FBQyxDQUFBO0FBQ2hDLHVCQUFtQixRQUFRLENBQUMsQ0FBQTtBQUs1Qix3QkFBK0IsV0FBSTtJQUlqQyxZQUFZLElBQXNCLEVBQUUsb0JBQXlDLEVBQUUsaUJBQXdCO1FBQ3JHLE1BQU0sSUFBSSxDQUFDLENBQUM7UUFDWixJQUFJLENBQUMsb0JBQW9CLEdBQUcsb0JBQW9CLENBQUM7UUFDakQsSUFBSSxDQUFDLGlCQUFpQixHQUFHLGlCQUFpQixDQUFDO1FBRTNDLElBQUksQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUN2QixDQUFDO0lBRUQsYUFBYTtRQUNYLElBQUksQ0FBQyxTQUFTLENBQUMsU0FBUyxFQUFFLENBQUMsS0FBSztZQUM5QixFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUM7Z0JBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQztZQUVwQyxJQUFJLE1BQU0sR0FBRyxJQUFJLENBQUM7WUFDbEIsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsR0FBRyxLQUFLLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3RDLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDdEIsTUFBTSxJQUFJLEdBQUcsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDL0IsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQztnQkFDYixNQUFNLEtBQUssR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUM7Z0JBQzlDLE1BQU0sR0FBRyxNQUFNLElBQUksQ0FBQyxDQUFDLFdBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDO1lBQ2hFLENBQUM7WUFDRCxNQUFNLENBQUMsTUFBTSxDQUFDO1FBQ2hCLENBQUMsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztJQUVELE1BQU0sQ0FBQyxRQUFlO1FBQ3BCLElBQUksQ0FBQyxTQUFTLENBQUMsUUFBUSxFQUFFLENBQUMsS0FBSyxLQUFLLENBQUMsV0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxLQUFLLENBQUMsTUFBTSxLQUFLLFFBQVEsQ0FBQyxDQUFDO1FBQ3hGLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0lBRUQsYUFBYSxDQUFDLEtBQVksRUFBRSxLQUFZO1FBQ3RDLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxFQUFFLENBQUMsS0FBSyxLQUFLLENBQUMsV0FBSSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsSUFBSSxDQUFDLEtBQUssS0FBSyxTQUFTLElBQUksS0FBSyxDQUFDLE1BQU0sSUFBSSxLQUFLLENBQUMsQ0FBQyxDQUFDO1FBQ3RLLE1BQU0sQ0FBQyxJQUFJLENBQUM7SUFDZCxDQUFDO0FBQ0gsQ0FBQztBQXJDWSxpQkFBUyxZQXFDckIsQ0FBQSIsImZpbGUiOiJpc0FycmF5T2YuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vdHlwaW5ncy91bmRlcnNjb3JlL3VuZGVyc2NvcmUuZC50c1wiIC8+XG5cbmltcG9ydCAqIGFzIF8gZnJvbSBcInVuZGVyc2NvcmVcIjtcbmltcG9ydCB7QmFzZX0gZnJvbSBcIi4vYmFzZVwiO1xuXG5leHBvcnQgZGVjbGFyZSB0eXBlIG9iamVjdFZhbGlkYXRvciA9IChjaGlsZFZhbGlkYXRvcikgPT4gdm9pZDtcbmV4cG9ydCBkZWNsYXJlIHR5cGUgaXRlbVZhbGlkYXRvckZhY3RvcnkgPSAocGF0aDooc3RyaW5nfG51bWJlcilbXSkgPT4gQmFzZTtcblxuZXhwb3J0IGNsYXNzIElzQXJyYXlPZiBleHRlbmRzIEJhc2Uge1xuICBpdGVtVmFsaWRhdG9yRmFjdG9yeTppdGVtVmFsaWRhdG9yRmFjdG9yeTtcbiAgaXRlbVZhbGlkYXRvck5hbWU6c3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKHBhdGg6KHN0cmluZ3xudW1iZXIpW10sIGl0ZW1WYWxpZGF0b3JGYWN0b3J5Oml0ZW1WYWxpZGF0b3JGYWN0b3J5LCBpdGVtVmFsaWRhdG9yTmFtZTpzdHJpbmcpIHtcbiAgICBzdXBlcihwYXRoKTtcbiAgICB0aGlzLml0ZW1WYWxpZGF0b3JGYWN0b3J5ID0gaXRlbVZhbGlkYXRvckZhY3Rvcnk7XG4gICAgdGhpcy5pdGVtVmFsaWRhdG9yTmFtZSA9IGl0ZW1WYWxpZGF0b3JOYW1lO1xuXG4gICAgdGhpcy52YWxpZGF0ZUFycmF5KCk7XG4gIH1cblxuICB2YWxpZGF0ZUFycmF5KCkge1xuICAgIHRoaXMuc2F0aXNmaWVzKCdpc0FycmF5JywgKHZhbHVlKSA9PiB7XG4gICAgICBpZiAoIV8uaXNBcnJheSh2YWx1ZSkpIHJldHVybiBmYWxzZTtcblxuICAgICAgbGV0IHBhc3NlZCA9IHRydWU7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGl0ZW0gPSB2YWx1ZVtpXTtcbiAgICAgICAgY29uc3QgcGF0aCA9IHRoaXMucGF0aC5zbGljZSgpO1xuICAgICAgICBwYXRoLnB1c2goaSk7XG4gICAgICAgIGNvbnN0IGNoaWxkID0gdGhpcy5pdGVtVmFsaWRhdG9yRmFjdG9yeShwYXRoKTtcbiAgICAgICAgcGFzc2VkID0gcGFzc2VkICYmICghQmFzZS5oYXNWYWx1ZShpdGVtKSB8fCBjaGlsZC50ZXN0KGl0ZW0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwYXNzZWQ7XG4gICAgfSk7XG4gIH1cblxuICBsZW5ndGgoZXhwZWN0ZWQ6bnVtYmVyKTp0aGlzIHtcbiAgICB0aGlzLnNhdGlzZmllcygnbGVuZ3RoJywgKHZhbHVlKSA9PiAhQmFzZS5oYXNWYWx1ZSh2YWx1ZSkgfHwgdmFsdWUubGVuZ3RoID09PSBleHBlY3RlZCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBsZW5ndGhJblJhbmdlKGxvd2VyOm51bWJlciwgdXBwZXI6bnVtYmVyKTp0aGlzIHtcbiAgICB0aGlzLnNhdGlzZmllcygnbGVuZ3RoSW5SYW5nZScsICh2YWx1ZSkgPT4gIUJhc2UuaGFzVmFsdWUodmFsdWUpIHx8IChsb3dlciA9PT0gdW5kZWZpbmVkIHx8IHZhbHVlLmxlbmd0aCA+PSBsb3dlcikgJiYgKHVwcGVyID09PSB1bmRlZmluZWQgfHwgdmFsdWUubGVuZ3RoIDw9IHVwcGVyKSk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cbn1cbiJdfQ==
